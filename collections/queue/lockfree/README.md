# 简介
bruceshao/lockfree是一个基于 Go 语言实现的高性能无锁队列库，旨在通过无锁（Lock-Free）算法提升多线程环境下的并发性能。
设计灵感来源于 Java 的 Disruptor 框架。

https://github.com/bruceshao/lockfree

# 特性
* 无锁设计基于CAS（Compare-And-Swap）原子操作实现入队和出队，完全避免传统锁（如sync.Mutex）的竞争开销，减少线程阻塞和上下文切换。
  - 仅在一处使用chan实现消费者阻塞唤醒，避免影响主流程性能。
* 单一消费者模型采用单一消费者协程设计，消除读操作竞争，降低内存屏障和缓存行争用，显著提升消费效率。
* 写不等待原则写入操作通过自旋和任务调度（如runtime.Gosched()）避免阻塞，确保高并发写入的流畅性。
* 环形缓冲区（RingBuffer）使用预分配的环形缓冲区存储数据，结合一次性内存分配策略，减少动态内存分配的开销，提升缓存局部性。通过位掩码（mask）快速计算索引，避免动态扩容的开销。
* 缓存行填充优化: 通过填充变量使其独占缓存行，避免伪共享（False Sharing），减少 CPU 缓存失效带来的性能损耗。
* 消费者唤醒机制: 当队列为空时，消费者协程通过chan进入阻塞状态；写入数据时，生产者会尝试唤醒消费者，确保低延迟响应。

# 适用性限制
* 单一消费者模型可能不适用于多消费者场景，需根据业务需求选择 MPMC（多生产者多消费者）或其他模式。
* 低竞争场景下，无锁队列可能不如有锁结构高效。


# 问题
* 不能在mac平台使用，报错：link: github.com/bruceshao/lockfree: invalid reference to runtime.osyield
